<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <script src="http://d3js.org/d3.v3.min.js"></script>
  <script src="http://dimplejs.org/dist/dimple.v2.1.2.js"></script>
  
  <style>

    circle {
      opacity: 0.6;
    }

  </style>
    <script type="text/javascript">
      function draw(data) {


      /*
        D3.js setup code
      */
          //Note: to use bl.ocks.org, must have svg fit within 960 x 500 pixels
          "use strict";

          var padding = 55,
              width = 960,
              height = 500,
              rightBar = width / 8,
              legendheight = height/4;

      
          var svg = d3.select("body")
            .append("svg")
              .attr("width", width)
              .attr("height", height)
            .append('g')
                .attr('class','chart');
          
          var yearfilter = d3.range(1990, 2016);
          yearfilter = yearfilter.toString().split(',');

          var frame = 2500; 
          var firstTick = true;
          
          var myChart = new dimple.chart(svg, data);
          myChart.setBounds(padding, 2*padding + 10, width - rightBar - 2 * padding, height- 3* padding - 10);
          var xAxis = myChart.addMeasureAxis("x", "R");
          var yAxis = myChart.addMeasureAxis("y", "PERIOD");
          xAxis.addOrderRule("R")
          var zAxis = myChart.addMeasureAxis("z", "numPlanets");
          
          xAxis.tickFormat = '.1f';
          //Show decimal value on mouse-over
          yAxis.tickFormat = '.1f';  

          //fix the axes so they don't shift around so much during animation
          xAxis.overrideMin = 0;
          xAxis.overrideMax = 100;
          yAxis.overrideMax = 500;
          yAxis.overrideMin = 0; //BMI axis does not need to go down to 0

          xAxis.title = "R (ratio of Jupiter)";
          yAxis.title = "Period (Days)";
          zAxis.title = "Number of Discovered Planets";

          var bubbleSeries = myChart.addSeries(["DATE", "PLANETDISCMETH"], dimple.plot.bubble);


          bubbleSeries.getTooltipText = function (e) {
                return [
                    "Day: " + e.aggField[0],
                    "Discovery Method: " + e.aggField[1].sqrt,
                    "Number Planets:" + (e.zValue).toFixed(2),
                    "Median Radius: " + Math.log10((e.xValue).toFixed(3)),
                    "Median Period: " + (e.yValue).toFixed(4)
                ];
            };


        //Add Plot Title
          svg.append("text")
            .attr("x", 20)
            .attr("y", 20)
            .style("text-anchor", "left")
            .style("font-family", "sans-serif")
            .style("font-weight", "bold")
            .text("Characteristics of Discovered Planets")

          svg.selectAll("discoveryLegendLabel")
            .data(["PLANETDISCMETH"])
            .enter()
            .append("text")
              .attr("x", 20)
              .attr("y", padding + 38 )
              .style("font-size", "14px")
              .style("font-weight", "bold")
              .style("color", "Black")
              .style("font-family", "sans-serif")
              .text(function (d) { return d; });

          //Planetary Discovery Methods legend above chart
          var myDiscoveryLegend = myChart.addLegend(padding, padding + 28,
                            rightBar * 4,legendheight, "center");


          myChart.draw()

          myChart.legends = [];

          var discoveryVals = dimple.getUniqueValues(data, "PLANETDISCMETH");

          myDiscoveryLegend.shapes.selectAll("rect")
            //Add a click event to each rectangle
            .on("click", function (e)  {
              //Is rectangle already visible?
              var hideRect = false;
              var newFilters = [];
              //if filters contain clicked shape then hide it
              discoveryVals.forEach(function (f) {
                if (f === e.aggField.slice(-1)[0]) {
                  hideRect = true;
                } else {
                  newFilters.push(f);
                }
              });
              // Either hide the shape or show it now
              if (hideRect) {
                d3.select(this).style("opacity", 0.2);
              } else {
                newFilters.push(e.aggField.slice(-1)[0]);
                d3.select(this).style("opacity", 0.8);
              }
              //Update our filters now
              discoveryVals = newFilters;
              //Filter the data by selected
              myChart.data = dimple.filterData(data, "PLANETDISCMETH", discoveryVals);
              myChart.draw(800);
              if (!isticking) { // only keep animation paused if it is already paused
                storyboard.pauseAnimation();
              }
              
            });

      };

</script>
</head>
<body>
  <script type="text/javascript">
  /*
    Use D3 (not dimple.js) to load the TSV file
    and pass the contents of it to the draw function
    */

  d3.csv("exoplanets.csv", function(d) {
    return {
          DATE: d.DATE,
          PLANETDISCMETH: d.PLANETDISCMETH,
          R: d.R,
          PERIOD: d.PERIOD,
          numPlanets: d.numPlanets
          };
        }, draw);
  

  </script>
</body>
</html>
